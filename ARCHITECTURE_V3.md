# Bot V3 æ¶æ„è®¾è®¡

## æ ¸å¿ƒåŸåˆ™
1. æ¨¡å—åŒ–è®¾è®¡ - æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æ¨¡å—
2. æ¸…æ™°çš„æ•°æ®æµ - ç”¨æˆ·è¾“å…¥ â†’ AIåˆ†æ â†’ æŒ‰é’®é€‰æ‹© â†’ æ‰§è¡Œ â†’ ç»“æœå±•ç¤º â†’ å¯è¿”å›
3. å®Œæ•´çš„é”™è¯¯å¤„ç† - æ¯ä¸€æ­¥éƒ½æœ‰é™çº§æ–¹æ¡ˆ
4. æ‰€æœ‰bytesæ­£ç¡®å¤„ç† - ç»Ÿä¸€è½¬æ¢ä¸ºhexå­—ç¬¦ä¸²å­˜å‚¨

## æ¨¡å—åˆ’åˆ†

### 1. SessionManager (ä¼šè¯ç®¡ç†)
```python
class SessionManager:
    - ç®¡ç†ç”¨æˆ·ä¼šè¯çŠ¶æ€
    - å­˜å‚¨AIåˆ†æç»“æœ
    - å­˜å‚¨ç”¨æˆ·é€‰æ‹©å†å²
    - æ”¯æŒè¿”å›ä¸Šä¸€æ­¥
```

### 2. AIAnalyzer (AIæ„å›¾åˆ†æ)
```python
class AIAnalyzer:
    - è°ƒç”¨Claude APIåˆ†æç”¨æˆ·è¾“å…¥
    - ç”Ÿæˆ3-5ä¸ªæœç´¢å»ºè®®
    - æå–å…³é”®è¯å’Œå‘½ä»¤
    - è¿”å›ç»“æ„åŒ–æ•°æ®
```

### 3. ButtonGenerator (æŒ‰é’®ç”Ÿæˆå™¨)
```python
class ButtonGenerator:
    - æ ¹æ®AIå»ºè®®ç”ŸæˆæŒ‰é’®
    - ä¸ºæœç´¢ç»“æœæ·»åŠ æ§åˆ¶æŒ‰é’®
    - ç»Ÿä¸€ç®¡ç†callback_data
```

### 4. SearchExecutor (æœç´¢æ‰§è¡Œå™¨)
```python
class SearchExecutor:
    - è½¬å‘æœç´¢åˆ°ç›®æ ‡bot
    - æ¥æ”¶å¹¶å¤„ç†ç»“æœ
    - æ­£ç¡®å¤„ç†bytesç±»å‹
    - è§¦å‘åå°ç¿»é¡µ
```

### 5. CacheManager (ç¼“å­˜ç®¡ç†å™¨) 
```python
class CacheManager:
    - æ‰€æœ‰bytesè½¬hexå­˜å‚¨
    - è¯»å–æ—¶hexè½¬bytes
    - ç»Ÿä¸€çš„å­˜å–æ¥å£
```

## ç”¨æˆ·äº¤äº’æµç¨‹

```
ç”¨æˆ·å‘é€: "æˆ‘æƒ³æ‰¾å¾·å·æ‰‘å…‹ç¾¤"
    â†“
[AIåˆ†æå™¨] åˆ†ææ„å›¾
    â†“
ç”Ÿæˆå»ºè®®:
  ğŸ” æŒ‰åç§°æœç´¢"å¾·å·æ‰‘å…‹ç¾¤"
  ğŸ’¬ æœç´¢è®¨è®º"å¾·å·æ‰‘å…‹"çš„ç¾¤
  ğŸ¯ æœç´¢"æ‰‘å…‹"ç›¸å…³å†…å®¹
  âœï¸ æ‰‹åŠ¨è¾“å…¥å‘½ä»¤
    â†“
ç”¨æˆ·ç‚¹å‡»: "æœç´¢è®¨è®ºå¾·å·æ‰‘å…‹çš„ç¾¤"
    â†“
[æœç´¢æ‰§è¡Œå™¨] æ‰§è¡Œ /text å¾·å·æ‰‘å…‹
    â†“
å±•ç¤ºç»“æœ + åº•éƒ¨æ§åˆ¶æŒ‰é’®:
  [...æœç´¢ç»“æœ...]
  [ä¸‹ä¸€é¡µ] [ä¸Šä¸€é¡µ]
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  [ğŸ”™ è¿”å›é‡é€‰] [ğŸ”„ ä¼˜åŒ–æœç´¢]
    â†“
ç”¨æˆ·ç‚¹å‡»: "è¿”å›é‡é€‰"
    â†“
è¿”å›å»ºè®®åˆ—è¡¨ï¼ˆä»ä¼šè¯æ¢å¤ï¼‰
```

## æ•°æ®ç»“æ„

### ç”¨æˆ·ä¼šè¯
```python
{
    "user_id": 123,
    "stage": "suggestions" | "searching" | "browsing",
    "history": [
        {
            "step": "input",
            "content": "æˆ‘æƒ³æ‰¾å¾·å·æ‰‘å…‹ç¾¤",
            "timestamp": "..."
        },
        {
            "step": "analysis",
            "suggestions": [...],
            "timestamp": "..."
        },
        {
            "step": "selected",
            "command": "/text",
            "keyword": "å¾·å·æ‰‘å…‹",
            "timestamp": "..."
        }
    ],
    "can_go_back": True
}
```

### AIå»ºè®®
```python
{
    "explanation": "æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘æ¨èä»¥ä¸‹æœç´¢æ–¹å¼",
    "suggestions": [
        {
            "command": "/text",
            "keyword": "å¾·å·æ‰‘å…‹",
            "description": "æœç´¢è®¨è®ºå¾·å·æ‰‘å…‹çš„ç¾¤ç»„",
            "icon": "ğŸ’¬",
            "priority": 1
        }
    ]
}
```

## æ–‡ä»¶ç»“æ„

```
telegram-bot/
â”œâ”€â”€ bot_v3.py                    # ä¸»ç¨‹åº
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ session_manager.py       # ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ ai_analyzer.py           # AIåˆ†æ
â”‚   â”œâ”€â”€ button_generator.py      # æŒ‰é’®ç”Ÿæˆ
â”‚   â”œâ”€â”€ search_executor.py       # æœç´¢æ‰§è¡Œ
â”‚   â””â”€â”€ cache_manager.py         # ç¼“å­˜ç®¡ç†
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ bytes_helper.py          # byteså·¥å…·å‡½æ•°
â”‚   â””â”€â”€ logger.py                # æ—¥å¿—å°è£…
â””â”€â”€ config.py                    # é…ç½®æ–‡ä»¶
```
